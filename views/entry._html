_html lang: 'en', _width: '99' do
  _title "Sam Ruby: #{@post.title}"
  _link rel: 'stylesheet', href: '/css/blogy.css', type: 'text/css', 
    media: 'screen'
  _link rel: 'stylesheet', href: '/css/print.css', type: 'text/css', 
    media: 'print'
  _link rel: 'shortcut icon', href: '/favicon.ico'
  _script :defer, src: '/js/localize_dates.js'

  _header do
    _h1 do
      _a.banner_anchor 'intertwingly', href: 'http://intertwingly.net/blog/'
    end

    _form method: 'get', action: 'http://intertwingly.net/blog/' do
      _label 'Search', for: 'q'
      _input.q! type: 'search', name: 'q', placeholder: 'Search', value: ''
    end
    _p "Itâ€™s just data"
  end

  _article_ do
    _header_ do
      _h3! { _a @post.title, href: '' }
      _time @mtime.utc.httpdate, title: 'GMT', datetime: @mtime.utc.iso8601
    end

    __{@post.icon.untaint} if @post.icon

    _{@post.body.untaint}

    _footer_
  end

  _a_.comments!

  sections = @post.comments.group_by {|comment| comment.mtime.utc.to_date}
  sections.sort.each do |date, comments|
    _section_ do
      _header_ do
        _h2! {_time date.to_s, datetime: date.to_s}
      end

      comments.sort_by {|comment| comment.mtime}.each do |comment|
        _article_ id: comment.fragment do
          _{comment.body.untaint}
          _ 'at'
          _a href: "##{comment.fragment}" do
            _time comment.mtime.utc.strftime('%H:%M:%S'), title: 'GMT',
              datetime: comment.mtime.utc.iso8601
          end
        end
      end
    end
  end

  _section.comment_form! do
    _header do
      _h2 'Add your comment'
    end

    _article do
      _form_ method: 'post', accept_charset: 'utf-8' do
        _p_ do
          _label 'Name:', for: 'name'
          _input.name! maxlength: '50', name: 'name', size: '75', 
            type: 'text', value: ''
        end

        _p_ do
          _label 'E-mail:', for: 'email'
          _input.email! maxlength: '75', name: 'email', size: '75',
            type: 'email', value: ''
        end

        _p_ do
          _label 'URI:', for: 'url'
          _input.url! maxlength: '100', name: 'url', size: '75', type: 'url',
            value: ''
        end

        _p_ do
          _label 'Comment:', for: 'comment'
          _textarea.comment! cols: '59', name: 'comment', rows: '12'
        end

        _input name: 'preview', type: 'submit', value: 'Preview'
        _input type: 'button', value: 'Clear Info'
        _input.bakecookie! type: 'checkbox', name: 'bakecookie'
        _label 'Remember info?', for: 'bakecookie'
      end
    end
  end

  _ &Snippets.sidebar

  _footer_ do
    _ &Snippets.menu
    _ &Snippets.watermark
  end
end
